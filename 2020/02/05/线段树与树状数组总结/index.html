<!DOCTYPE html><html class="appearance-auto" lang="zh-Hans"><head><meta charset="UTF-8"><title>çº¿æ®µæ ‘ä¸æ ‘çŠ¶æ•°ç»„æ€»ç»“</title><meta name="description" content="ACM/acm/Acm/é¢˜è§£/ç®—æ³•/åšå®¢/blog"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="  æœ¬æ–‡ç« ä¸º2020å¹´å¯’è®­ç”¨èµ„æ–™ï¼Œæœ‰éƒ¨åˆ†åˆ å‡
çº¿æ®µæ ‘
å¼•å…¥
é—®é¢˜å¼•å…¥ï¼š

é—®é¢˜ä¸€ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º\(n\)çš„æ•°åˆ—ï¼Œå¯ä»¥è¿›è¡Œ\(m\)æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®æŸ¥è¯¢åŒºé—´\([l,r]\)å†…æ‰€æœ‰æ•°çš„å’Œ

å¦‚æœæ•°æ®èŒƒå›´å¾ˆå°ï¼ˆä¾‹å¦‚\(n\leq 1000,m\leq 100\)ï¼‰ï¼Œå¯ä»¥ç›´æ¥æšä¸¾ã€‚å¤æ‚åº¦\(O(n)\)
å¦‚æœæ•°æ®èŒƒå›´è¾ƒå¤§ï¼ˆä¾‹å¦‚\(n\leq 1e6,m\leq 1e3\)ï¼‰ï¼Œå¯ä»¥ç”¨å‰ç¼€å’Œã€‚å¤æ‚åº¦\(O(n+m)\)

é—®é¢˜äºŒï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º\(n\)çš„æ•°åˆ—ï¼Œå¯ä»¥è¿›è¡Œ\(m\)æ¬¡æ“ä½œï¼Œæ“ä½œåˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¿®æ”¹å•ç‚¹çš„æ•°å€¼ï¼Œå¦ä¸€ç§æ˜¯æŸ¥è¯¢åŒºé—´\([l,r]\)å†…æ‰€æœ‰æ•°çš„å’Œ

å¦‚æœæ•°æ®èŒƒå›´å¾ˆå°ï¼Œä¾ç„¶å¯ä»¥æšä¸¾ã€‚å¤æ‚åº¦\(O(n)\)
ä½†å¤§æ•°æ®èŒƒå›´çš„æƒ…å†µä¸‹ä¼šTLE
æ­¤æ—¶å³ä½¿ä½¿ç”¨å‰ç¼€å’Œï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ“ä½œåéœ€è¦ç»´æŠ¤å‰ç¼€å’Œï¼Œæ•…å¤æ‚åº¦ä¸.."><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="-xGeminix-" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">NeoRuTayE's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">çº¿æ®µæ ‘ä¸æ ‘çŠ¶æ•°ç»„æ€»ç»“</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/Love">ğŸ§¸</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/Love">ğŸ§¸</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-text">çº¿æ®µæ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-text">å¼•å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">çº¿æ®µæ ‘æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E6%A0%91"><span class="toc-text">å»ºæ ‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E6%93%8D%E4%BD%9C"><span class="toc-text">å•ç‚¹æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E6%9F%A5%E8%AF%A2"><span class="toc-text">å•ç‚¹æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E4%BF%AE%E6%94%B9"><span class="toc-text">å•ç‚¹ä¿®æ”¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E9%97%B4%E6%93%8D%E4%BD%9C"><span class="toc-text">åŒºé—´æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">åŒºé—´æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E9%97%B4%E4%BF%AE%E6%94%B9"><span class="toc-text">åŒºé—´ä¿®æ”¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%8F%E6%B3%95%E8%BF%90%E7%AE%97%E5%92%8C%E4%B9%98%E6%B3%95%E8%BF%90%E7%AE%97"><span class="toc-text">å‡æ³•è¿ç®—å’Œä¹˜æ³•è¿ç®—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="toc-text">ç¦»æ•£åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95"><span class="toc-text">æ‹“å±•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="toc-text">æ ‘çŠ¶æ•°ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-1"><span class="toc-text">å¼•å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E6%95%B0%E7%BB%84c%E4%B8%8Elowbit"><span class="toc-text">è¾…åŠ©æ•°ç»„cä¸lowbit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%8E%E6%9F%A5%E8%AF%A2"><span class="toc-text">ä¿®æ”¹ä¸æŸ¥è¯¢</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/ACM"><i class="tag post-item-tag">ACM</i></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><i class="tag post-item-tag">æ•°æ®ç»“æ„</i></a><a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91"><i class="tag post-item-tag">çº¿æ®µæ ‘</i></a><a href="/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><i class="tag post-item-tag">æ ‘çŠ¶æ•°ç»„</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">çº¿æ®µæ ‘ä¸æ ‘çŠ¶æ•°ç»„æ€»ç»“</h1><time class="has-text-grey" datetime="2020-02-05T15:04:00.000Z">2020-02-05</time><article class="mt-2 post-content"><p><img src="https://pic.downk.cc/item/5e3adbdf2fb38b8c3ccee2f7.jpg"> <span id="more"></span> æœ¬æ–‡ç« ä¸º2020å¹´å¯’è®­ç”¨èµ„æ–™ï¼Œæœ‰éƒ¨åˆ†åˆ å‡</p>
<h2 id="çº¿æ®µæ ‘">çº¿æ®µæ ‘</h2>
<h3 id="å¼•å…¥">å¼•å…¥</h3>
<p>é—®é¢˜å¼•å…¥ï¼š</p>
<ul>
<li>é—®é¢˜ä¸€ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(n\)</span>çš„æ•°åˆ—ï¼Œå¯ä»¥è¿›è¡Œ<span class="math inline">\(m\)</span>æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®æŸ¥è¯¢åŒºé—´<span class="math inline">\([l,r]\)</span>å†…æ‰€æœ‰æ•°çš„å’Œ
<ul>
<li>å¦‚æœæ•°æ®èŒƒå›´å¾ˆå°ï¼ˆä¾‹å¦‚<span class="math inline">\(n\leq 1000,m\leq 100\)</span>ï¼‰ï¼Œå¯ä»¥ç›´æ¥æšä¸¾ã€‚å¤æ‚åº¦<span class="math inline">\(O(n)\)</span></li>
<li>å¦‚æœæ•°æ®èŒƒå›´è¾ƒå¤§ï¼ˆä¾‹å¦‚<span class="math inline">\(n\leq 1e6,m\leq 1e3\)</span>ï¼‰ï¼Œå¯ä»¥ç”¨å‰ç¼€å’Œã€‚å¤æ‚åº¦<span class="math inline">\(O(n+m)\)</span></li>
</ul></li>
<li>é—®é¢˜äºŒï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(n\)</span>çš„æ•°åˆ—ï¼Œå¯ä»¥è¿›è¡Œ<span class="math inline">\(m\)</span>æ¬¡æ“ä½œï¼Œæ“ä½œåˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¿®æ”¹å•ç‚¹çš„æ•°å€¼ï¼Œå¦ä¸€ç§æ˜¯æŸ¥è¯¢åŒºé—´<span class="math inline">\([l,r]\)</span>å†…æ‰€æœ‰æ•°çš„å’Œ
<ul>
<li>å¦‚æœæ•°æ®èŒƒå›´å¾ˆå°ï¼Œä¾ç„¶å¯ä»¥æšä¸¾ã€‚å¤æ‚åº¦<span class="math inline">\(O(n)\)</span></li>
<li>ä½†å¤§æ•°æ®èŒƒå›´çš„æƒ…å†µä¸‹ä¼šTLE</li>
<li>æ­¤æ—¶å³ä½¿ä½¿ç”¨å‰ç¼€å’Œï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ“ä½œåéœ€è¦ç»´æŠ¤å‰ç¼€å’Œï¼Œæ•…å¤æ‚åº¦ä¸æšä¸¾ä¸€è‡´ã€‚å¤§æ•°æ®èŒƒå›´çš„æƒ…å†µä¸‹ä¾ç„¶ä¼šTLE</li>
</ul></li>
<li>é—®é¢˜ä¸‰ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(n\)</span>çš„æ•°åˆ—ï¼Œå¯ä»¥è¿›è¡Œ<span class="math inline">\(m\)</span>æ¬¡æ“ä½œï¼Œæ“ä½œåˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¿®æ”¹åŒºé—´<span class="math inline">\([l,r]\)</span>å†…æ¯ä¸ªæ•°çš„æ•°å€¼ï¼Œå¦ä¸€ç§æ˜¯æŸ¥è¯¢åŒºé—´<span class="math inline">\([l,r]\)</span>å†…æ‰€æœ‰æ•°çš„å’Œ
<ul>
<li>æ•°æ®èŒƒå›´å°çš„è¯å½“ç„¶å¯ä»¥æšä¸¾â€¦â€¦</li>
<li>å¦‚æœæ•°æ®èŒƒå›´å¾ˆå¤§å‘¢ï¼Ÿï¼ˆä¾‹å¦‚<span class="math inline">\(n\leq 1e6,m\leq 1e3\)</span>ï¼‰</li>
</ul></li>
</ul>
<h3 id="çº¿æ®µæ ‘æ˜¯ä»€ä¹ˆ">çº¿æ®µæ ‘æ˜¯ä»€ä¹ˆ</h3>
<p>çº¿æ®µæ ‘æ˜¯ä¸€ç§äºŒå‰æ ‘ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸Šä¿å­˜åŒºé—´ä¿¡æ¯ï¼Œå¹¶åœ¨æ ‘ä¸Šè¿›è¡ŒåŒºé—´ã€‚ä¸‹å›¾æ˜¯åŒºé—´<span class="math inline">\([1,7]\)</span>å¯¹åº”çš„çº¿æ®µæ ‘</p>
<p><img src="https://pic.downk.cc/item/5e3ada242fb38b8c3cceb6bb.png"></p>
<p>ä¸Šé¢è¿™å¼ å›¾æ‰€è¡¨ç¤ºçš„æ„æ€æ˜¯ï¼Œä»¥æ±‚åŒºé—´å’Œä¸ºä¾‹ï¼Œå¯¹äºåŒºé—´<span class="math inline">\([1,7]\)</span>ï¼Œå…¶åŒºé—´å’Œç­‰äºå…¶å·¦å„¿å­<span class="math inline">\(([1,4])\)</span>çš„åŒºé—´å’ŒåŠ ä¸Šå…¶å³å„¿å­<span class="math inline">\([5,7]\)</span>çš„åŒºé—´å’Œï¼›è€ŒåŒºé—´<span class="math inline">\([1,4]\)</span>çš„åŒºé—´å’Œåˆç­‰äºåŒºé—´<span class="math inline">\([1,2]\)</span>å’ŒåŒºé—´<span class="math inline">\([3,4]\)</span>çš„å’Œã€‚å¯¹äºä¸€ä¸ªåŒºé—´<span class="math inline">\([lef,rig]\)</span>ï¼Œå…¶å·¦å³å„¿å­åˆ†åˆ«ä¸º<span class="math inline">\([lef,\lfloor(lef+rig)/2\rfloor]\)</span>ï¼Œ<span class="math inline">\([\lfloor(lef+rig)/2\rfloor+1,rig]\)</span>ã€‚å¯¹äºçº¿æ®µæ ‘ä¸Šçš„å„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬é‡‡å–ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦å¾€å³çš„ç¼–å·æ–¹æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œ<span class="math inline">\([1,7]\)</span>æ˜¯ç¼–å·ä¸º1ï¼Œ<span class="math inline">\([1,4]\)</span>ç¼–å·ä¸º2ï¼Œ<span class="math inline">\([5,7]\)</span>ç¼–å·ä¸º3â€¦â€¦</p>
<p>å¯¹äºæŸ¥è¯¢ä¸ä¿®æ”¹ï¼Œçº¿æ®µæ ‘çš„å¤æ‚åº¦éƒ½æ˜¯<span class="math inline">\(O(\log_2n)\)</span></p>
<h3 id="å»ºæ ‘">å»ºæ ‘</h3>
<p>æ ¹æ®çº¿æ®µæ ‘çš„ç»“æ„å’ŒèŠ‚ç‚¹ç¼–å·æ–¹å¼ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¾—åˆ°ä»¥ä¸‹å»ºæ ‘æ–¹å¼</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">int</span> sum[maxn&lt;&lt;<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-3" title="3">{</a>
<a class="sourceLine" id="cb1-4" title="4">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb1-5" title="5">}</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-7" title="7">{</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb1-9" title="9">        <span class="dt">int</span> tmp;</a>
<a class="sourceLine" id="cb1-10" title="10">        scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;tmp);</a>
<a class="sourceLine" id="cb1-11" title="11">        sum[rt]=tmp;</a>
<a class="sourceLine" id="cb1-12" title="12">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb1-13" title="13">    }</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb1-15" title="15">    build(lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-16" title="16">    build(mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-17" title="17">    pushup(rt);</a>
<a class="sourceLine" id="cb1-18" title="18">}</a></code></pre></div>
<p>ä»£ç å¾ˆçŸ­ï¼Œä½†æœ‰äº›åœ°æ–¹å¯èƒ½ä¼šè®©åˆæ¬¡æ¥è§¦çš„äººç¨å¾®æœ‰ç‚¹ç–‘æƒ‘ï¼š</p>
<ul>
<li><p>maxn&lt;&lt;2æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>æ­¤å¤„maxnè¡¨ç¤ºçš„æ˜¯æœ€å¤§åŒºé—´é•¿åº¦ï¼Œmaxn&lt;&lt;2ç­‰åŒäº4 * maxnã€‚sumæ˜¯ç”¨æ¥å­˜æˆ‘ä»¬çš„çº¿æ®µæ ‘èŠ‚ç‚¹çš„æ•°ç»„ã€‚ä¸ºä»€ä¹ˆéœ€è¦å¼€4å€å¤§çš„ç©ºé—´å‘¢ï¼Ÿé¦–å…ˆï¼Œçº¿æ®µæ ‘æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œ å¯¹äºä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œå‡å¦‚æœ‰<span class="math inline">\(n\)</span>ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆå¯¹åº”åˆ°çº¿æ®µæ ‘ä¸Šå°±æ˜¯åŒºé—´æ€»é•¿åº¦ä¸º<span class="math inline">\(n\)</span>ï¼‰ï¼Œå…¶æ€»èŠ‚ç‚¹æ•°ä¸º<span class="math inline">\(2n-1\)</span>ã€‚ä¼¼ä¹å¼€2å€å°±å¤Ÿäº†å‘¢â€¦â€¦ä½†ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œå¼€å››å€æ˜¯è¾ƒä¸ºä¿é™©çš„é€‰æ‹©ï¼Œæ—¢ä¸ä¼šå¤ªå¤§å¯¼è‡´MLEï¼Œä¹Ÿä¸ä¼šå¤ªå°å¯¼è‡´è¶Šç•Œã€‚</p></li>
<li><p>rt&lt;&lt;1å’Œrt&lt;&lt;1|1</p>
<p>ç”±äºçº¿æ®µæ ‘èŠ‚ç‚¹çš„ç¼–å·æ–¹å¼ï¼Œçˆ¶èŠ‚ç‚¹å’Œå…¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç¼–å·å­˜åœ¨è¿™æ ·çš„å…³ç³»ï¼š<span class="math display">\[id_{leftson}=2\times id_{father}\]</span>ï¼Œ<span class="math display">\[id_{rigson}=2\times id_{father}+1\]</span></p>
<p>ä¸ºäº†æé«˜é€Ÿåº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½è¿ç®—æ¥ä»£æ›¿ä¹˜æ³•ã€åŠ æ³•ã€‚</p></li>
<li><p>pushup</p>
<p>çˆ¶äº²èŠ‚ç‚¹çš„ä¿¡æ¯æ¥è‡ªäºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæ•…åœ¨å®Œæˆå­èŠ‚ç‚¹çš„å»ºç«‹åï¼Œæˆ‘ä»¬è¦ç”¨ä¸¤ä¸ªå­èŠ‚ç‚¹æ¥å»ºç«‹çˆ¶äº²èŠ‚ç‚¹</p></li>
</ul>
<h3 id="å•ç‚¹æ“ä½œ">å•ç‚¹æ“ä½œ</h3>
<p>å•ç‚¹æ“ä½œåŒ…æ‹¬å•ç‚¹æŸ¥è¯¢ä¸å•ç‚¹ä¿®æ”¹</p>
<h4 id="å•ç‚¹æŸ¥è¯¢">å•ç‚¹æŸ¥è¯¢</h4>
<p>å•ç‚¹æŸ¥è¯¢çš„å¤§è‡´æ€æƒ³ä¸äºŒåˆ†æŸ¥æ‰¾ç±»ä¼¼ã€‚å¦‚æœéœ€è¦æŸ¥è¯¢çš„ä½ç½®<span class="math inline">\(pos\)</span>åœ¨å½“å‰åŒºé—´çš„å·¦ä¾§ï¼Œåˆ™æŸ¥æ‰¾å½“å‰åŒºé—´çš„å·¦å„¿å­ï¼›å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰åŒºé—´çš„å³å„¿å­ã€‚é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œç›´è‡³åŒºé—´å·¦å³ç«¯ç‚¹ç›¸ç­‰ï¼Œåˆ™è¯´æ˜å·²ç»æ‰¾åˆ°ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1"><span class="dt">int</span> ans;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="dt">void</span> query(<span class="dt">int</span> pos,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb2-3" title="3">{</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb2-5" title="5">        ans=sum[rt];</a>
<a class="sourceLine" id="cb2-6" title="6">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-7" title="7">    }</a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="cf">if</span>(pos&lt;=mid) query(pos,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="cf">else</span> <span class="cf">if</span>(pos&gt;mid) query(pos,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-11" title="11">}</a></code></pre></div>
<h4 id="å•ç‚¹ä¿®æ”¹">å•ç‚¹ä¿®æ”¹</h4>
<p>å•ç‚¹ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1"><span class="dt">void</span> update(<span class="dt">int</span> pos,<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb3-2" title="2">{</a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb3-4" title="4">        sum[rt]+=val;</a>
<a class="sourceLine" id="cb3-5" title="5">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb3-6" title="6">    }</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="cf">if</span>(pos&lt;=mid) update(pos,val,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="cf">else</span> <span class="cf">if</span>(pos&gt;mid) update(pos,val,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-10" title="10">    pushup(rt);</a>
<a class="sourceLine" id="cb3-11" title="11">}</a></code></pre></div>
<p>ä¸å•ç‚¹æŸ¥è¯¢åŸºæœ¬ä¸€è‡´ï¼Œä½†è¦è®°å¾—æœ€åpushupä¸€ä¸‹æ¥æ›´æ–°çˆ¶èŠ‚ç‚¹ã€‚</p>
<h3 id="åŒºé—´æ“ä½œ">åŒºé—´æ“ä½œ</h3>
<p>åŒºé—´æ“ä½œçš„æ€»ä½“æ€æƒ³æ˜¯ï¼Œå¯¹äºå¸¦æŸ¥è¯¢çš„åŒºé—´<span class="math inline">\([L,R]\)</span>ï¼Œå¦‚æœå½“å‰åŒºé—´<span class="math inline">\([lef,rig]\)</span>å®Œå…¨åŒ…å«åœ¨å¸¦æŸ¥è¯¢åŒºé—´ä¸­ï¼Œå°±ç›´æ¥å°†<span class="math inline">\([lef,rig]\)</span>ä¸Šçš„ä¿¡æ¯ç»Ÿè®¡åˆ°ç­”æ¡ˆä¸­ã€‚å¦‚ä¸‹æ‰€ç¤º <span class="math display">\[
\underbrace{L,L+1,\dots \overbrace{lef,lef+1,\dots ,rig-1,rig}\dots ,R-1,R}
\]</span> å¦åˆ™ï¼Œå¦‚æœå½“å‰åŒºé—´ä¸æ˜¯å®Œå…¨åŒ…å«åœ¨å¾…æŸ¥è¯¢åŒºé—´å†…ï¼Œå°±æŸ¥è¯¢å·¦å„¿å­æˆ–å³å„¿å­ã€‚å¦‚ä¸‹æ‰€ç¤º <span class="math display">\[
\rlap{\overbrace{\phantom{lef,lef+1,\dots,L,L+1,\dots,rig-1,rig}}} lef,lef+1,\dots, \underbrace{L, L+1,\dots,rig-1,rig,\dots,R-1,R}
\]</span></p>
<h4 id="åŒºé—´æŸ¥è¯¢">åŒºé—´æŸ¥è¯¢</h4>
<p>å€Ÿç”¨ä¸Šé¢æ‰€æåˆ°çš„æ€»ä½“æ€æƒ³ï¼Œå¯ä»¥å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="dt">int</span> query(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb4-2" title="2">{</a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="cf">if</span>(lef&gt;=L&amp;&amp;rig&lt;=R){</a>
<a class="sourceLine" id="cb4-4" title="4">           <span class="cf">return</span> sum[rt];     </a>
<a class="sourceLine" id="cb4-5" title="5">    }</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="cf">if</span>(L&lt;=mid) ret+=query(L,R,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="cf">if</span>(R&gt;mid) ret+=query(L,R,mid+<span class="dv">1</span>,rt&lt;&lt;<span class="dv">1</span>); </a>
<a class="sourceLine" id="cb4-10" title="10">}</a></code></pre></div>
<h4 id="åŒºé—´ä¿®æ”¹">åŒºé—´ä¿®æ”¹</h4>
<p>å€Ÿç”¨å•ç‚¹ä¿®æ”¹çš„æ€æƒ³ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ï¼ŒåŒºé—´ä¿®æ”¹å°±æ˜¯ç›¸å½“äºè°ƒç”¨å¤šæ¬¡å•ç‚¹ä¿®æ”¹ï¼ŒæŠŠåŒºé—´å†…çš„æ•°å­—éƒ½ä¿®æ”¹äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºåŒºé—´<span class="math inline">\([1,7]\)</span>ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹<span class="math inline">\([2,7]\)</span>å†…çš„æ•°ï¼Œé‚£æœ€ç»ˆè¢«ä¿®æ”¹çš„èŠ‚ç‚¹å¦‚ä¸‹å›¾æ‰€ç¤º <img src="https://pic.downk.cc/item/5e3ada522fb38b8c3ccebc1d.png"></p>
<p>ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜åœ¨äºï¼Œè¿™æ ·åšçš„è¯ï¼Œå¤æ‚åº¦ä¼šæ¯”ç›´æ¥æš´åŠ›ä¿®æ”¹è¿˜é«˜ï¼è€Œä¸”ï¼Œå¦‚æœæˆ‘è¦æŸ¥è¯¢çš„åªæ˜¯<span class="math inline">\([5,7]\)</span>çš„å­åŒºé—´ï¼Œé‚£å°±ä¼šå­˜åœ¨ä¸å¿…è¦çš„ä¿®æ”¹ã€‚æ¯”å¦‚è¯´æˆ‘è¦æŸ¥è¯¢<span class="math inline">\([1,5]\)</span>ï¼Œé‚£<span class="math inline">\([5,6]\)</span>ç­‰ç­‰çš„ä¿®æ”¹å°±æ²¡æœ‰ç”¨ã€‚</p>
<p>äº‹å®ä¸Šï¼Œè¦ä¿®æ”¹åŒºé—´<span class="math inline">\([2,7]\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…ä¿®æ”¹æˆ‘ä»¬éœ€è¦çš„åŒºé—´ã€‚å…·ä½“è€Œè¨€ï¼Œä¿®æ”¹çš„æ—¶å€™åªéœ€è¦ä¿®æ”¹<span class="math inline">\([1,7],[1,4],[1,2],[2,2],[3,4],[5,7]\)</span>ã€‚ç­‰åˆ°éœ€è¦æŸ¥è¯¢è¿™äº›åŒºé—´ä»¥å¤–çš„åŒºé—´æ—¶ï¼Œå†å»è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚è¿™å°±æ˜¯æ‡’æƒ°æ ‡è®°ï¼ˆlazy tagï¼‰çš„æ€æƒ³</p>
<p>æ‰€è°“æ‡’æƒ°ï¼Œå°±æ˜¯â€œè¦ç”¨çš„æ—¶å€™æ‰ç”¨ï¼Œå¦åˆ™å°±ä¸ç”¨â€ã€‚å…·ä½“æ¥è¯´ï¼Œæ‡’æƒ°æ ‡è®°ç”¨äºå­˜å‚¨çˆ¶èŠ‚ç‚¹çš„ä¿®æ”¹ä¿¡æ¯ï¼Œä½†æš‚æ—¶ä¸æŠŠä¿¡æ¯ä¼ ç»™å­èŠ‚ç‚¹ï¼Œç­‰åˆ°éœ€è¦ç”¨åˆ°å­èŠ‚ç‚¹æ—¶å†æŠŠä¿¡æ¯ä¼ ç»™å­èŠ‚ç‚¹ã€‚</p>
<p>åŠ ä¸Šäº†æ‡’æƒ°æ ‡è®°çš„åŒºé—´ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb5-1" title="1"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt,<span class="dt">int</span> len)</a>
<a class="sourceLine" id="cb5-2" title="2">{</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="cf">if</span>(lazy[rt]){</a>
<a class="sourceLine" id="cb5-4" title="4">        lazy[rt&lt;&lt;<span class="dv">1</span>]+=lazy[rt];</a>
<a class="sourceLine" id="cb5-5" title="5">        lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]+=lazy[rt];</a>
<a class="sourceLine" id="cb5-6" title="6">        sum[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>]*(len-(len&gt;&gt;<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb5-7" title="7">        sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*(len&gt;&gt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-8" title="8">        lazy[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb5-9" title="9">    }</a>
<a class="sourceLine" id="cb5-10" title="10">}</a>
<a class="sourceLine" id="cb5-11" title="11"><span class="dt">void</span> update(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb5-12" title="12">{</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="cf">if</span>(lef&gt;=L&amp;&amp;rig&lt;=R){</a>
<a class="sourceLine" id="cb5-14" title="14">        sum[rt]+=val*(rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-15" title="15">        lazy[rt]+=val;</a>
<a class="sourceLine" id="cb5-16" title="16">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb5-17" title="17">    }</a>
<a class="sourceLine" id="cb5-18" title="18">    pushdown(rt);</a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb5-20" title="20">    <span class="cf">if</span>(L&lt;=mid) update(L,R,val,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-21" title="21">    <span class="cf">if</span>(R&gt;mid) update(L,R,val,mid+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-22" title="22">    pushup(rt);</a>
<a class="sourceLine" id="cb5-23" title="23">}</a></code></pre></div>
<p>åŠ ä¸Šæ‡’æƒ°æ ‡è®°åï¼ŒåŒæ ·æ˜¯ä¿®æ”¹<span class="math inline">\([2,7]\)</span>è¿™ä¸€åŒºé—´ï¼Œè¢«ä¿®æ”¹çš„åŒºé—´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://pic.downk.cc/item/5e3ada6a2fb38b8c3ccebf3e.png"></p>
<p>å¦å¤–ï¼Œåœ¨å¼•å…¥äº†æ‡’æƒ°æ ‡è®°åï¼Œå•ç‚¹æŸ¥è¯¢ã€åŒºé—´æŸ¥è¯¢çš„ä»£ç ä¹Ÿè¦æ›´æ”¹ï¼ˆå…¶å®å°±æ˜¯åŠ ä¸Špushdownè€Œå·²ï¼‰ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<p>å•ç‚¹æŸ¥è¯¢ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb6-1" title="1"><span class="dt">int</span> query(<span class="dt">int</span> pos,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb6-2" title="2">{</a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb6-4" title="4">           <span class="cf">return</span> sum[rt];     </a>
<a class="sourceLine" id="cb6-5" title="5">    }</a>
<a class="sourceLine" id="cb6-6" title="6">    pushdown(rt);</a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="cf">if</span>(lef&lt;=mid) ret+=query(pos,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="cf">else</span> <span class="cf">if</span>(rig&gt;mid) ret+=query(pos,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb6-11" title="11">    <span class="cf">return</span> ret;</a>
<a class="sourceLine" id="cb6-12" title="12">}</a></code></pre></div>
<p>åŒºé—´æŸ¥è¯¢ï¼š</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" title="1"><span class="dt">int</span> query(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb7-2" title="2">{</a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="cf">if</span>(L&gt;=lef&amp;&amp;R&lt;=rig){</a>
<a class="sourceLine" id="cb7-4" title="4">        <span class="cf">return</span> sum[rt];</a>
<a class="sourceLine" id="cb7-5" title="5">    }</a>
<a class="sourceLine" id="cb7-6" title="6">    pushdown(rt);</a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="cf">if</span>(L&lt;=mid) ret+=query(L,R,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="cf">if</span>(R&gt;mid) ret+=query(L,R,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="cf">return</span> ret;</a>
<a class="sourceLine" id="cb7-12" title="12">}</a></code></pre></div>
<h3 id="å‡æ³•è¿ç®—å’Œä¹˜æ³•è¿ç®—">å‡æ³•è¿ç®—å’Œä¹˜æ³•è¿ç®—</h3>
<p>ä¸Šé¢æ‰€æåˆ°çš„éƒ½æ˜¯ä¿®æ”¹ä¸æŸ¥è¯¢éƒ½æ˜¯åŸºäºåŠ æ³•çš„ï¼Œé‚£å¦‚æœæ˜¯å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å‘¢ï¼Ÿ</p>
<ul>
<li><p>å¦‚æœæ˜¯å‡æ³•çš„è¯å°±ç›´æ¥åŠ ä¸Šè´Ÿæ•°å³å¯ã€‚</p></li>
<li><p>å¦‚æœæ˜¯ä¹˜æ³•æˆ–é™¤æ³•çš„è¯ï¼Œå°±è¦å¦å½“åˆ«è®ºã€‚</p>
<p>ï¼ˆæ­¤å¤„åªè®¨è®ºåŒºé—´æŸ¥è¯¢ä¸åŒºé—´ä¿®æ”¹ï¼Œå¦‚æœåŒºé—´çš„ä¼šäº†ï¼Œå•ç‚¹è‚¯å®šä¹Ÿä¼šå§ :Dï¼‰</p>
<ul>
<li><p>å¯¹äºä¹˜æ³•ï¼Œåªéœ€è¦åƒè¿™ä¸ªæ ·å­ä¿®æ”¹updateï¼š</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" title="1"><span class="dt">void</span> update(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-2" title="2">{</a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="cf">if</span>(lef&gt;=L&amp;&amp;rig&lt;=R){</a>
<a class="sourceLine" id="cb8-4" title="4">        lazy[rt]*=val;</a>
<a class="sourceLine" id="cb8-5" title="5">        sum[rt]*=lazy[rt];</a>
<a class="sourceLine" id="cb8-6" title="6">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-7" title="7">    }</a>
<a class="sourceLine" id="cb8-8" title="8">    pushdown(rt);</a>
<a class="sourceLine" id="cb8-9" title="9">    <span class="dt">int</span> mid=(lef+rig)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="cf">if</span>(L&lt;=mid) update(L,R,val,lson);</a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="cf">if</span>(R&gt;mid) update(L,R,val,rson);</a>
<a class="sourceLine" id="cb8-12" title="12">}</a></code></pre></div>
<p>è¿™æ ·ä¿®æ”¹pushdownï¼š</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" title="1"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb9-2" title="2">{</a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="cf">if</span>(lazy[rt]!=<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb9-4" title="4">        lazy[rt&lt;&lt;<span class="dv">1</span>]*=lazy[rt];</a>
<a class="sourceLine" id="cb9-5" title="5">        lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*=lazy[rt];</a>
<a class="sourceLine" id="cb9-6" title="6">        sum[rt&lt;&lt;<span class="dv">1</span>]=sum[rt&lt;&lt;<span class="dv">1</span>]*lazy[rt];</a>
<a class="sourceLine" id="cb9-7" title="7">        sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*lazy[rt];</a>
<a class="sourceLine" id="cb9-8" title="8">        lazy[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb9-9" title="9">    }</a>
<a class="sourceLine" id="cb9-10" title="10">}</a></code></pre></div>
<p>å¦å¤–è¦è®°å¾—åˆå§‹åŒ–lazyä¸­æ‰€æœ‰æ•°ä¸º1</p>
<p>PSï¼šæ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ä¹˜æ³•å’ŒåŠ æ³•åŒæ—¶è¿›è¡Œï¼Œå³åŒºé—´ä¿®æ”¹æ“ä½œä¸­ï¼Œæ—¢å¯ä»¥å°†åŒºé—´ä¸Šçš„æ•°ä¹˜ä»¥ä¸€ä¸ªæ•°ï¼Œä¹Ÿå¯ä»¥å°†åŒºé—´ä¸Šçš„æ•°åŠ ä¸Šä¸€ä¸ªæ•°ï¼Œé‚£è¦æ€ä¹ˆç»´æŠ¤sumå’Œlazyå‘¢ï¼Ÿ</p></li>
</ul></li>
</ul>
<h3 id="ç¦»æ•£åŒ–">ç¦»æ•£åŒ–</h3>
<p>æ‰€è°“ç¦»æ•£åŒ–æŒ‡çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæ•°æ®èŒƒå›´è¿‡å¤§ï¼Œç›´æ¥ä¿å­˜æ•°æ®çš„åšæ³•ä¼šå¯¼è‡´MLEï¼›ä½†è¦è§£å‡ºé¢˜ç›®å…¶å®å¹¶ä¸éœ€è¦ä¿å­˜å®é™…çš„æ•°æ®ï¼Œåªéœ€è¦ä¿å­˜æ•°æ®ä¹‹é—´çš„ç›¸å¯¹å¤§å°å³å¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨è¦åœ¨ä¸€æ¡é•¿åº¦ä¸º<span class="math inline">\(1e9\)</span>çš„çº¿æ®µä¸Šè¿›è¡ŒåŒºé—´æŸ“è‰²ï¼Œé¢œè‰²ä¸é¢œè‰²ä¹‹é—´ä¼šç›¸äº’è¦†ç›–ï¼Œæ±‚æœ€ç»ˆçº¿æ®µä¸Šå¯ä»¥çœ‹åˆ°å¤šå°‘ç§é¢œè‰²ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¼€ä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(4e9\)</span>çš„æ•°ç»„æ¥å­˜çº¿æ®µæ ‘èŠ‚ç‚¹ï¼Œä¹Ÿä¸å¯èƒ½å¼€ä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(4e9\)</span>çš„æ•°ç»„æ¥å­˜æ‡’æƒ°æ ‡è®°ã€‚å¦‚ä½•è§£å†³è¿™ä¸€é—®é¢˜å‘¢ï¼Ÿæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨å…¶å®å¹¶ä¸å…³å¿ƒè¢«æŸ“è‰²çš„çº¿æ®µå…·ä½“æœ‰å¤šé•¿ï¼Œè€Œåªå…³å¿ƒçº¿æ®µä¹‹é—´çš„å…³ç³»ï¼ˆç›¸å¯¹å¤§å°ï¼Œä½ç½®å…³ç³»ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€ä¸ªéœ€è¦æŸ“è‰²çš„åŒºé—´çš„å·¦å³ç«¯ç‚¹åˆ†é…ä¸€ä¸ªidï¼Œå¹¶é€šè¿‡idæ¥å»ºç«‹çº¿æ®µæ ‘ã€‚æ‰€æœ‰çš„ä¿®æ”¹ä¸æŸ¥è¯¢éƒ½åœ¨è¿™æ£µâ€idçº¿æ®µæ ‘â€œä¸Šè¿›è¡Œã€‚ç¦»æ•£åŒ–çš„å®é™…å®ç°ä¸€èˆ¬é€šè¿‡sort()å’Œuniqueã€‚</p>
<p>ä¸‹é¢ç”¨ä¸€é“ä¾‹é¢˜æ¥è®²è§£ï¼š</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://poj.org/problem?id=2528">Mayor's posters</a></p>
<p>é¢˜ç›®å¤§æ„æ˜¯è¯´ï¼Œæœ‰ä¸€å µé•¿ä¸º10000000ï¼Œç°åœ¨è¦åœ¨å¢™ä¸Šè´´<span class="math inline">\(n(1\leq n\leq 10000)\)</span>å¼ æµ·æŠ¥ï¼ˆæµ·æŠ¥ä¸æµ·æŠ¥ä¹‹é—´ä¼šç›¸äº’è¦†ç›–ï¼‰ï¼Œé—®è´´å®Œæ‰€æœ‰æµ·æŠ¥åï¼Œèƒ½çœ‹åˆ°çš„æµ·æŠ¥æœ‰å¤šå°‘å¼ ï¼Ÿ</p>
<p>ä¸ä¸Šé¢æåˆ°çš„æŸ“è‰²é—®é¢˜æ€è·¯ä¸€è‡´ï¼Œå°†æ¯å¼ æµ·æŠ¥ç¦»æ•£åŒ–åï¼Œç”¨ç¦»æ•£åŒ–å¾—åˆ°çš„idå»ºç«‹çº¿æ®µæ ‘ï¼Œå¹¶é€šè¿‡queryæŸ¥è¯¢èƒ½çœ‹åˆ°çš„æµ·æŠ¥çš„æ•°ç›®ã€‚å®Œæˆç¦»æ•£åŒ–åï¼Œé€šè¿‡lower_bound()æŸ¥è¯¢å·¦å³ç«¯ç‚¹å¯¹åº”çš„idã€‚</p>
<p>å‚è€ƒä»£ç ï¼š</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb10-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">10005</span>;</a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb10-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="dt">int</span> vis[<span class="dv">10000</span>+<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb10-23" title="23"><span class="dt">int</span> lazy[maxn&lt;&lt;<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb10-24" title="24"><span class="kw">struct</span> node{</a>
<a class="sourceLine" id="cb10-25" title="25">    <span class="dt">int</span> lef;</a>
<a class="sourceLine" id="cb10-26" title="26">    <span class="dt">int</span> rig;</a>
<a class="sourceLine" id="cb10-27" title="27">};</a>
<a class="sourceLine" id="cb10-28" title="28">node ps[<span class="dv">20000</span>+<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb10-29" title="29"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-30" title="30">{</a>
<a class="sourceLine" id="cb10-31" title="31">    <span class="cf">if</span>(lazy[rt]!=<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb10-32" title="32">        lazy[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt];</a>
<a class="sourceLine" id="cb10-33" title="33">        lazy[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-34" title="34">    }</a>
<a class="sourceLine" id="cb10-35" title="35">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-36" title="36">}</a>
<a class="sourceLine" id="cb10-37" title="37"><span class="dt">int</span> ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-38" title="38"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-39" title="39">{</a>
<a class="sourceLine" id="cb10-40" title="40">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb10-41" title="41">        lazy[rt]=todo;</a>
<a class="sourceLine" id="cb10-42" title="42">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-43" title="43">    }</a>
<a class="sourceLine" id="cb10-44" title="44">    pushdown(rt);</a>
<a class="sourceLine" id="cb10-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-46" title="46">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb10-47" title="47">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb10-48" title="48">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb10-49" title="49">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb10-50" title="50">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-51" title="51">}</a>
<a class="sourceLine" id="cb10-52" title="52"><span class="dt">void</span> query(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-53" title="53">{</a>
<a class="sourceLine" id="cb10-54" title="54">    <span class="cf">if</span>(lazy[rt]){</a>
<a class="sourceLine" id="cb10-55" title="55">        <span class="cf">if</span>(!vis[lazy[rt]]){</a>
<a class="sourceLine" id="cb10-56" title="56">            ans++;</a>
<a class="sourceLine" id="cb10-57" title="57">            vis[lazy[rt]]=<span class="dv">1</span>;    </a>
<a class="sourceLine" id="cb10-58" title="58">        }</a>
<a class="sourceLine" id="cb10-59" title="59">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-60" title="60">    }</a>
<a class="sourceLine" id="cb10-61" title="61">    <span class="cf">if</span>(lef==rig)</a>
<a class="sourceLine" id="cb10-62" title="62">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-63" title="63">    pushdown(rt);</a>
<a class="sourceLine" id="cb10-64" title="64">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-65" title="65">    <span class="cf">if</span>(lef&lt;=mid)</a>
<a class="sourceLine" id="cb10-66" title="66">        query(lson);</a>
<a class="sourceLine" id="cb10-67" title="67">    <span class="cf">if</span>(rig&gt;mid)</a>
<a class="sourceLine" id="cb10-68" title="68">        query(rson);</a>
<a class="sourceLine" id="cb10-69" title="69">}</a>
<a class="sourceLine" id="cb10-70" title="70"><span class="dt">int</span> lsh[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb10-71" title="71"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb10-72" title="72">{</a>
<a class="sourceLine" id="cb10-73" title="73">    <span class="dt">int</span> t;</a>
<a class="sourceLine" id="cb10-74" title="74">    cin&gt;&gt;t;</a>
<a class="sourceLine" id="cb10-75" title="75">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb10-76" title="76">        <span class="dt">int</span> idx=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-77" title="77">        mst(lsh,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb10-78" title="78">        mst(lazy,<span class="dv">0</span>);mst(vis,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb10-79" title="79">        ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-80" title="80">        <span class="dt">int</span> n;cin&gt;&gt;n;</a>
<a class="sourceLine" id="cb10-81" title="81">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb10-82" title="82">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;ps[i].lef,&amp;ps[i].rig);</a>
<a class="sourceLine" id="cb10-83" title="83">            lsh[idx++]=ps[i].lef;lsh[idx++]=ps[i].rig;</a>
<a class="sourceLine" id="cb10-84" title="84">        }</a>
<a class="sourceLine" id="cb10-85" title="85">        sort(lsh,lsh+idx);</a>
<a class="sourceLine" id="cb10-86" title="86">        <span class="dt">int</span> cnt=unique(lsh,lsh+idx)-lsh;</a>
<a class="sourceLine" id="cb10-87" title="87">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb10-88" title="88">            <span class="dt">int</span> L=lower_bound(lsh,lsh+cnt,ps[i].lef)-lsh+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-89" title="89">            <span class="dt">int</span> R=lower_bound(lsh,lsh+cnt,ps[i].rig)-lsh+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-90" title="90">            update(L,R,i+<span class="dv">1</span>,<span class="dv">1</span>,cnt+<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-91" title="91">        }</a>
<a class="sourceLine" id="cb10-92" title="92">        query(<span class="dv">1</span>,cnt+<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-93" title="93">        printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb10-94" title="94">    }</a>
<a class="sourceLine" id="cb10-95" title="95">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-96" title="96">}</a></code></pre></div>
<h3 id="æ‹“å±•">æ‹“å±•</h3>
<p>æ‹“å±•å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>åŒºé—´é™¤ã€ç»´æŠ¤åŒºé—´å¹³æ–¹å’Œã€ç»´æŠ¤åŒºé—´ç«‹æ–¹å’Œã€åŒºé—´ä½è¿ç®—...</p></li>
<li>æ‰«æçº¿</li>
<li>æƒå€¼çº¿æ®µæ ‘</li>
<li>ä¸»å¸­æ ‘</li>
<li><p>etc...</p></li>
</ul>
<h2 id="æ ‘çŠ¶æ•°ç»„">æ ‘çŠ¶æ•°ç»„</h2>
<h3 id="å¼•å…¥-1">å¼•å…¥</h3>
<p>æ‰€è°“æ ‘çŠ¶æ•°ç»„ï¼Œå°±æ˜¯ç”¨æ•°ç»„æ¥æ¨¡æ‹Ÿæ ‘å½¢ç»“æ„ï¼Œå¸¸ç”¨äºè§£å†³ä¸€äº›åŒºé—´é—®é¢˜ï¼ˆåŒºé—´åŠ ã€åŒºé—´æ±‚å’Œç­‰ï¼‰ã€‚ç›¸è¾ƒäºçº¿æ®µæ ‘ï¼Œå…¶ä¼˜ç‚¹åœ¨äºå¸¸æ•°æ›´å°ï¼Œä¸”ä»£ç æ›´çŸ­ã€‚ç¼ºç‚¹åœ¨äºåŠŸèƒ½æ¯”è¾ƒæœ‰é™ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„åŒºé—´é—®é¢˜å¾ˆéš¾è§£å†³ï¼Œç”šè‡³æ˜¯æ— æ³•è§£å†³ã€‚å¯ä»¥è¯´ï¼Œèƒ½ç”¨æ ‘çŠ¶æ•°ç»„è§£å†³çš„é—®é¢˜éƒ½èƒ½ç”¨çº¿æ®µæ ‘è§£å†³ï¼Œä½†èƒ½ç”¨çº¿æ®µæ ‘è§£å†³çš„é—®é¢˜ä¸ä¸€å®šèƒ½ç”¨æ ‘çŠ¶æ•°ç»„è§£å†³ã€‚</p>
<h3 id="è¾…åŠ©æ•°ç»„cä¸lowbit">è¾…åŠ©æ•°ç»„cä¸lowbit</h3>
<p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªåºåˆ—<span class="math inline">\(a_n\)</span>ï¼Œå…¶é•¿åº¦ä¸º<span class="math inline">\(n(1\leq n\leq1e6)\)</span>ï¼Œå¯è¿›è¡Œ<span class="math inline">\(m(1\leq m \leq 1e3)\)</span>æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œè¦ä¹ˆæ˜¯å¯¹ä¸€ä¸ªæ•°åŠ ä¸Šä¸€ä¸ªæ•°å€¼ï¼ˆå•ç‚¹ä¿®æ”¹ï¼‰ï¼Œè¦ä¹ˆæ˜¯æŸ¥è¯¢ä¸€æ®µåŒºé—´å†…çš„æ€»å’Œï¼ˆåŒºé—´æŸ¥è¯¢ï¼‰ã€‚</p>
<p>è¿™ä¸€é—®é¢˜å½“ç„¶å¯ä»¥ç”¨ä¸Šé¢æ‰€è¯´çš„çº¿æ®µæ ‘æ¥è§£å†³ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¼•å…¥æ ‘çŠ¶æ•°ç»„ã€‚</p>
<p>é¦–å…ˆå®šä¹‰å‡½æ•°<span class="math inline">\(lowbit(x)\)</span>ï¼Œæœ‰ <span class="math display">\[
lowbit(x)=x\&amp;(-x)
\]</span></p>
<p><span class="math inline">\(lowbit(x)\)</span>çš„å…·ä½“å«ä¹‰åœ¨äºï¼Œæ±‚å‡º<span class="math display">\[x\]</span>æœ€ä½ä½1æ‰€å¯¹åº”çš„å€¼ã€‚æ¯”æ–¹è¯´ï¼Œ<span class="math display">\[lowbit(10100_2)=100_2=4_{10}\]</span>ï¼Œ<span class="math display">\[lowbit(10001111_2)=1_2=1_{10}\]</span>ï¼Œ<span class="math display">\[lowbit(100010_2)=10_2=2_{10}\]</span></p>
<p>å†å®šä¹‰ä¸€ä¸ªè¾…åŠ©æ•°ç»„<span class="math inline">\(c_i\)</span>ï¼Œæœ‰ <span class="math display">\[$
c_i=a_{i}+a_{i-1}+\dots+a_{i-lowbit(i)+1}
\]</span>$</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œc[i]è¡¨ç¤ºçš„æ˜¯, ä»a[i]å¼€å§‹ï¼Œä¸€ç›´åˆ° a[i-lowbit(i)+1] è¿™ä¸€é•¿åº¦ä¸ºlowbit(i) çš„è¿ç»­åŒºé—´çš„æ€»å’Œã€‚å¦‚ä¸‹å›¾</p>
<p><img src="https://pic.downk.cc/item/5e3adb222fb38b8c3cced2a6.png"></p>
<p>æ„å»ºå‡ºæ¥çš„æ ‘çŠ¶æ•°ç»„å¤§è‡´é•¿ä¸‹é¢è¿™ä¸ªæ ·å­</p>
<p><img src="https://pic.downk.cc/item/5e3adb452fb38b8c3cced59d.jpg"></p>
<h3 id="ä¿®æ”¹ä¸æŸ¥è¯¢">ä¿®æ”¹ä¸æŸ¥è¯¢</h3>
<p>æ­¤å¤„åªè€ƒè™‘å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚</p>
<ul>
<li><p>å•ç‚¹ä¿®æ”¹ï¼šå½“æˆ‘ä»¬è¦ä¿®æ”¹<span class="math display">\[a_j\]</span>çš„æ—¶å€™ï¼Œå› ä¸ºæœ‰<span class="math display">\[c_i=a_i+a_{i-1}+\dots+a_{i-lowbit(i)+1}\]</span>ï¼Œæ‰€ä»¥ä¿®æ”¹ä¸€ä¸ªæ•°å¯èƒ½ä¼šå¯¼è‡´å¤šä¸ª<span class="math display">\[c_i\]</span>çš„æ”¹å˜ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™ä¹ˆç¼–å†™å•ç‚¹ä¿®æ”¹çš„ä»£ç ï¼š</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb11-1" title="1"><span class="dt">void</span> add(<span class="dt">int</span> i,<span class="dt">int</span> val)</a>
<a class="sourceLine" id="cb11-2" title="2">{</a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="cf">while</span>(i&lt;=n){</a>
<a class="sourceLine" id="cb11-4" title="4">        c[i]+=val;</a>
<a class="sourceLine" id="cb11-5" title="5">        i+=lowbit(i);</a>
<a class="sourceLine" id="cb11-6" title="6">    }</a>
<a class="sourceLine" id="cb11-7" title="7">}</a></code></pre></div></li>
<li><p>å¯¹äºåŒºé—´æŸ¥è¯¢ï¼Œ<span class="math inline">\(c_i\)</span>çš„å®šä¹‰è®©æˆ‘ä»¬æƒ³åˆ°ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡æ±‚å‰ç¼€å’Œçš„æ–¹æ³•æ±‚åŒºé—´å’Œã€‚å› æ­¤ï¼ŒæŸ¥è¯¢çš„ä»£ç å¯ä»¥è¿™æ ·ç¼–å†™ï¼š</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb12-1" title="1"><span class="dt">int</span> query(<span class="dt">int</span> i)</a>
<a class="sourceLine" id="cb12-2" title="2">{</a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="dt">int</span> ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="cf">while</span>(i&gt;<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb12-5" title="5">        ans+=c[i];</a>
<a class="sourceLine" id="cb12-6" title="6">        i-=lowbit(i);</a>
<a class="sourceLine" id="cb12-7" title="7">    }</a>
<a class="sourceLine" id="cb12-8" title="8">}</a></code></pre></div></li>
</ul>
<p>é€šè¿‡è§‚å¯Ÿä¿®æ”¹ã€æŸ¥è¯¢çš„ä»£ç ï¼Œä»¥åŠæ ‘çŠ¶æ•°ç»„çš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ ‘çŠ¶æ•°ç»„å…¶å®å·§ç”¨äºŒè¿›åˆ¶æ¥å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œåˆ†æ®µã€‚ä»¥ä¸€ä¸ªé•¿åº¦ä¸º7çš„åºåˆ—ä¸ºä¾‹ï¼Œæœ‰ <span class="math display">\[
\begin{aligned}
lowbit(1)&amp;=1,c_1=a_1;\\
lowbit(2)&amp;=2,c_2=a_2+a_1;\\
lowbit(3)&amp;=1,c_2=a_3;\\
lowbit(4)&amp;=4,c_4=a_4+a_3+a_2+a_1;\\
lowbit(5)&amp;=1,c_5=a_5;\\
lowbit(6)&amp;=2,c_6=a_6+a_5;\\
lowbit(7)&amp;=1,c_7=a_7;
\end{aligned}
\]</span> æˆ‘ä»¬æŠŠè¿™äº›æ•°æ®å¥—åˆ°query()ä»£ç ä¸­ï¼Œå¯ä»¥å‘ç°ï¼ŒåŠ ä¸Šçš„<span class="math inline">\(c[i]\)</span>åˆ†åˆ«æ˜¯<span class="math inline">\(c[7],c[6],c[4]\)</span>ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(a[7],a[6]+a[5],a[4]+a[3]+a[2]+a[1]\)</span>è¿™ä¸‰æ®µã€‚</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2020/03/03/ACG016B-Colorful-Hats/" title="AGC016B Colorful Hats"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: AGC016B Colorful Hats</span></a><a class="button is-default" href="/2019/11/25/2018%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="2018-2019ç®—æ³•å­¦ä¹ æ€»ç»“"><span class="has-text-weight-semibold">Next: 2018-2019ç®—æ³•å­¦ä¹ æ€»ç»“</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/haojen"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright Â©</span><span> NeoRuTayE 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>